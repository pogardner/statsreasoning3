---
title: "statsreasoning3"
authors: "Paige Gardner"
format: pdf
editor: visual
---

## Libraries

```{r}
library(brms) # for statistics
library(tidyverse) # for data wrangling

# a function to scale and center. from rethinking package
standardize <- function(x) {
    x <- scale(x)
    z <- as.numeric(x)
    attr(z,"scaled:center") <- attr(x,"scaled:center")
    attr(z,"scaled:scale") <- attr(x,"scaled:scale")
    return(z)
}
```

## Q1.1

![](images/clipboard-129105804.png)

## Q1.2 Forks

U ← A → B

B← C → Y

## Q1.3 Colliders

X→ Y← C

U ← B → C

## Q1.4

![](images/clipboard-3111119872.png)

## Q1.5

X \<- U -\> B \<- C -\> Y

X \<- U -\> B \<- C \<- V -\> Y

X \<- U \<-A -\> C -\> Y

X \<- U \<-A -\> C \<- V -\> Y

### Q1.6 Identify open backdoor paths

A path is open if it has no collider, and closed if it has a collider.

The only open door path:

X \<- U \<-A -\> C -\> Y

### Q1.7 Identify variables to close the backdoor(s)

Which variables to condition on?

I don't fully understand what it means to condition on a variable

Condition on variables U and C?

# Part 2

## Load in data

```{r}
library(rethinking)
foxes <- read.csv('https://raw.githubusercontent.com/rmcelreath/rethinking/refs/heads/master/data/foxes.csv', sep = ';')
```

```{r}
?foxes
head(foxes)
```

## Q 2.1

Answer: I see a pipe: Area -\> avgfood -\> weight

This pipe can even be larger: Area -\> avgfood -\> groupsize -\> weight

```{r}
fox_dat <- foxes %>%
  as_tibble() %>%
  select(area, avgfood, weight, groupsize) %>%
  mutate(across(everything(), standardize))
```

Simulate from some priors for a linear regression with intercept *alpha* and slope *beta*: *alpha* \~ Gaussian(0, 0.2), *beta* \~ Gaussian(0, 2)

```{r}
n <- 1000
priorsims <- tibble(group = seq_len(n),
       alpha = rnorm(n, 0, 0.2), # prior for alpha
       beta = rnorm(n, 0, 2)) %>% # prior for beta
  expand(nesting(group, alpha, beta), # the expand function gives us all possible combinations of the arguments
         area = seq(from = -2, to = 2, length.out = 100)) %>% # set up a range of areas
  mutate(weight = alpha + beta * area) # calculate weight from the parameters and area
```

### Q2.2 Minimum fox weight

What to you seems like a reasonable minimum weight for a fox, in kg?

**Answer**: 5 kg

------------------------------------------------------------------------

### Q2.3 Maximum fox weight

What to you seems like a reasonable minimum weight for a fox, in kg?

**Answer:** 15 kg

## Q 2.4

### Step 1: Standardize the min and max values

```{r}

# I asked co-pilot for help
# I'm making a new function for single values, since you can't standardize a single value (no standard deviation)
standardize_single <- function(x, center, scale) {
  z <- (x - center) / scale
  attr(z, "scaled:center") <- center
  attr(z, "scaled:scale") <- scale
  z
}

standardize_single(5,10,2) # simulated mean of 10, SD of 2
standardize_single(15,10,2)

# Min: -2.5
# Max: 2.5
```

### Step 2: Plot

```{r}
ggplot(priorsims, aes(x = area, y = weight, group = group)) +
  geom_line(alpha = 1 / 10) +
  geom_hline(yintercept= c(-2.5, 2.5))+
  labs(x = "Standardized Area", y = "Standardized Weight")
```

## Q2.5

Answer: The priors seem much too large in the tails. I set the maximum size as 15 kg and the minimum size as 5 kg, assuming that foxes are actually pretty small animals. I was fairly conservative in this assumption, but the priors set in the first part of this exercise have extremely large tails.

### Q 2.6

I think that the effect of area on weight is being inflated. I am going to make the standard deviation 1.5 instead of 2.

*Update: I ran it with 1.5, then updated that to 1 because the range of weights still felt too broad.*

```{r}
# this is a prior predictive simulation, and NOT the same as a brm
n <- 1000
priorsims_updated <- tibble(group = seq_len(n),
       alpha = rnorm(n, 0, 0.2), # prior for alpha
       beta = rnorm(n, 0, 1)) %>% # prior for beta
  expand(nesting(group, alpha, beta), # the expand function gives us all possible combinations of the arguments
         area = seq(from = -2.5, to = 2.5, length.out = 100)) %>% # set up a range of areas
  mutate(weight = alpha + beta * area) # calculate weight from the parameters and area
```

```{r}
ggplot(priorsims_updated, aes(x = area, y = weight, group = group)) +
  geom_line(alpha = 1 / 10) +
  geom_hline(yintercept= c(-2.5, 2.5))+
  labs(x = "Standardized Area", y = "Standardized Weight")
```

### Q2.7

```{r}
food_on_weight <- brm(weight ~ 1 + avgfood, 
                    data = fox_dat, 
                    family = gaussian,
                    # Here we set the priors that we investigated earlier
                    prior = c(prior(normal(0, 0.1), class = Intercept), # prior for the intercept (expected value
                              # of weight when avgfood) I would think this would be negative skewed?
                              prior(normal(0, 1), class = b,), # prior for slope of the effect of avgfood on weight
                              prior(exponential(1), class = sigma)), # prior for how much data vary around regression line
                    # asked co-pilot for help on this: set exponential to make positive values, and allow for greater
                    # variation around regression for larger values of area
                    iter = 4000, warmup = 2000, chains = 4, cores = 4, seed = 1234,
                    file = "output/food_on_weight")
```

```{r}
summary(food_on_weight)
```

**Summary:** The effect of food appears to be negative, but the confidence interval is really poor. It contains 0, so that says to me that the effect of avg_food on weight is either not important (which doesn't make biological sense), or we are not capturing the effect of food with the priors / model set up.

### Q2.8

**Answer:** We should condition on groupsize, which is in the middle of the pipe from avgfood -\> groupsize -\> weight

### Q2.9

**Hypothesis:** Increasing the number of foxes will increase competition for resources. Therefore, increasing groupsize would decrease fox weight.

```{r}
food_direct <- brm(weight ~ 1 + avgfood + groupsize, 
                   data = fox_dat,
                   family = gaussian,
                   prior = c(prior(normal(0, 0.2), class = Intercept),
                             prior(normal(0, 0.5), class = b,),
                             prior(exponential(1), class = sigma)),
                   iter = 4000, warmup = 2000, chains = 4, cores = 4, seed = 1234,
                   file = "output/food_direct")

summary(food_direct)
```

### Q 2.10a

The effects of food: 0.47 (95% CI 0.1-0.84)

The effects of groupsize: -0.57 (95% CI -0.93 - -0.20)

### Q2.10b

The univariate regressions showed no effect of avg food or group size on weight, which biologically did not make sense. When conditioning on groupsize, we see that the effect of group size on weight is strongly negative, and the effect of avg food is strongly positive.

### Q2.10c

Fox territories are a factor of three main variables: area, amount of food present, and group size, and these variables vary as a function of each other. Because group size is a function of the amount of food present, we conditioned the model on this variable to estimate the direct effect of average food on fox size. When conditioning on group size, the effect of food increases fox weight by 0.47 unit of body weight per unit of food. However, group size decreases fox weight by 0.57 unit weight per individual added to the group.

A univariate model does not account for how different variables change as a function of another, so a univariate model masks the true relationships.
